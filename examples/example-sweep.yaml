# Parameter sweep configuration
# Sweeps perform Cartesian product expansion over multiple parameter values
# This example sweeps over chunked-prefill-size (2 values) Ã— max-total-tokens (2 values) = 4 jobs

name: "example-sweep"

# Define sweep parameters - all combinations will be tested
sweep:
  chunked_prefill_size: [4096, 8192]
  max_total_tokens: [8192, 16384]

model:
  path: "deepseek-r1"
  container: "lmsysorg+sglang+v0.5.5.post2.sqsh"
  precision: "fp8"

resources:
  gpu_type: "gb200"
  prefill_nodes: 1
  decode_nodes: 4
  prefill_workers: 1
  decode_workers: 4
  gpus_per_node: 4

slurm:
  account: "your-account"
  partition: "batch"
  time_limit: "04:00:00"

backend:
  prefill_environment:
    TORCH_DISTRIBUTED_DEFAULT_TIMEOUT: "1800"
    PYTHONUNBUFFERED: "1"

  decode_environment:
    TORCH_DISTRIBUTED_DEFAULT_TIMEOUT: "1800"
    PYTHONUNBUFFERED: "1"

  sglang_config:
    prefill:
      served-model-name: "deepseek-ai/DeepSeek-R1"
      model-path: "/model/"
      trust-remote-code: true
      kv-cache-dtype: "fp8_e4m3"
      disaggregation-mode: "prefill"
      tensor-parallel-size: 4
      max-total-tokens: "{max_total_tokens}"
      chunked-prefill-size: "{chunked_prefill_size}"

    decode:
      served-model-name: "deepseek-ai/DeepSeek-R1"
      model-path: "/model/"
      trust-remote-code: true
      kv-cache-dtype: "fp8_e4m3"
      disaggregation-mode: "decode"
      tensor-parallel-size: 4
      chunked-prefill-size: "{chunked_prefill_size}"

benchmark:
  type: "sa-bench"
  isl: 1024
  osl: 1024
  concurrencies: [256, 512]
  req_rate: "inf"

# This generates 4 jobs:
#   1. example-sweep_chunked_prefill_size4096_max_total_tokens8192
#   2. example-sweep_chunked_prefill_size4096_max_total_tokens16384
#   3. example-sweep_chunked_prefill_size8192_max_total_tokens8192
#   4. example-sweep_chunked_prefill_size8192_max_total_tokens16384
#
# Usage:
#   uv run srtctl dry-run -f example-sweep.yaml  # Preview jobs (sweep auto-detected)
#   uv run srtctl apply -f example-sweep.yaml    # Submit all jobs (sweep auto-detected)
